# Swarms Robot Metacontroller

## What is this metacontroller?

It is known that offline control design methods generate control software during design time, test it on simulation, and then deploy it on real robots. [More about offline design methods](https://www.frontiersin.org/articles/10.3389/frobt.2019.00059/full). It is also worth to note that a control software generated during design time and then deplyoyed, might not be the most appropriate controller all of the time since the conditions of the environment tend to often change, and here a question arise: What about having the possiblities to allow robots to choose the most suitable controller for the given conditions? 


## What is this metacontroller?

This metacontroller demonstrates how to allow robots to adapt their behaviour when some conditions change. It is supposed to be deloyed on each robot in the swarm.

### What is the idea?

This metacontroller uses a pre-generated software control for the robot swarms, store them in a file that will be stored on each robot, and during runtime, it monitors if certain conditions exceed a predefined threshold, and if it is the case, the metacontroller picks the right controller configuration and deploys it on the robot. 

This metacontroller is supposed to easily integrate with any control software, to use it, and choose the right configurations in order to have the most appropriate behaviour for the robots.

## How is it built?

This metacontroller uses:
- [AutoMoDe](https://github.com/demiurge-project/ARGoS3-AutoMoDe) as a robot controller. AutoMoDe is an offline design method that uses a probabilistic finite state machine to design control software. We used [Chocolate](https://iridia.ulb.ac.be/IridiaTrSeries/rev/IridiaTr2014-015r003.pdf) variant.
- [ARGoS3] https://github.com/ilpincy/argos3. Argos3 is a simulator that is used in many fields, including robot swarms, and it is based on c++.
- Dependendencies required for AutoMoDe [dependencies](https://iridia.ulb.ac.be/wiki/Getting_started_for_Demiurge).
- For the loop function, I used the one used in AutoMoDe and I have made modifications to it according the my experiments. You find the modified version [here](https://github.com/FahimaGold/experiments-loop-functions).

## How to install it

- Install the dependencies mentioned earlier and follow the steps to install them [follow these instructions](https://iridia.ulb.ac.be/wiki/Getting_started_for_Demiurge).

- Clone this repository
- `cd SWARMS_METACONTROLLER`
- `mkdir build && cd build`
- `cmake ..`
- `make`

## How to run it

from the `SWARMS_METACONTROLLER` folder run:
`./bin/metacontroller_main -c src/example/example.argos -s 0   --fsm-config --nstates 1 --s0 3`

where `s`is the random seed of argos3, and --fsm-config the FSM configuration. It can be anything respecting the encoded format used in AutoMoDe. And `-c` the argos flag that expects the `.argos` file.

## Example

An example is found in `src/example/example.argos`, it uses the loopfunctions for the aggregation mission used in AutoMoDe, 20 e-puck robots, 2 black spots, and one light source in the environment. The objective function is defined as the maximum number of robots aggregated in one of the black spot divided by the total number of robots, by the end of the experiment.

Under the same folder, the file `pfsm-config.txt`contains the PFSM configurations which used in the metacontroller to perform the switch according to threshold of the light intensitiy: 1.0 (low intensity) and 5.0 (high intensity). 

The below images depict the graphical visualization for both PFSM configurations used in this metacontroller.

[Light Intensity 1.0](/Users/mac/Documents/Thesis/fsm/200k/aggregation_cngID_31291light_0.1.png)]

[Light Intensity 5.0](/Users/mac/Documents/Thesis/fsm/200k/aggregation_configID3_light_5.0.png)

Both images show show the first best configuration that was generated by [irace](https://mlopez-ibanez.github.io/irace/)(the optimization algorithm used in AutoMoDe chocolate to produce the software control),when the light intensity is 1,0, and 5,0 respectively. The PFSM consists of 6 behavious (states) and 6 conditions (transitions), the same that were defined and used in AutoMoDe. 

The first image, shows the PFSM configuration when the light intensity was 1.0, and where the objective function score was 0.05 on average. The initial behaviour is Phtotataxis (The behaviour where the robot tend to go attracted to the light source), and they stopd when the floor color is black with a certain probability, and then they get attracted to each other if the floor is of black color and they are in stop state.

The second images, shows a PFSM configuration when the light intensity is 5.0, and there is only one state, Anti-Phototaxis (Running away from the light source). The objective function was in this case 0.

I ran the metacontroller, having intially the light intensity 5.0, and I gave it the appropriate PFSM configuration: `./bin/metacontroller_main -c src/example/example.argos -s 0   --fsm-config --nstates 1 --s0 3`. In the loop function, I handled the change of the light intensity to 1.0, after 100 timesteps from the start of the experiment. By the end of the experiment, the objective function was **0.1** on average, which means much better than running the same PFSM all along the experiment. In other words, choosing the appropriate PFSM when the light intensity changed, allowed to increase the objective function. 

The first screenshot shows the PFSM generated when the light intensity was 5.0, and was taken before reaching 100 timesteps.[Anti-Phototaxis](/Users/mac/Documents/Thesis/fsm/200k/Screenshot 2023-06-15 at 15.08.04.png)

The second screenshot was taken exactly at 100 timesteps.[100timesteps](/Users/mac/Documents/Thesis/fsm/200k/Screenshot 2023-06-15 at 15.08.32.png).


The third screenshot was taken some time after 100 timesteps.[+500timesteps](/Users/mac/Documents/Thesis/fsm/200k/Screenshot 2023-06-15 at 15.09.24.png).

The fourth screenshot was taken after 1000 timesteps. [+1000timesteps](/Users/mac/Documents/Thesis/fsm/200k/Screenshot 2023-06-15 at 15.11.22.png)